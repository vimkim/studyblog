+++
title = 'Log Structured Storage'
date = 2024-04-17T20:24:40+09:03
tags = ["database"]
+++

### 데이터 관리에서 변경 불가능한 저장 구조와 변경 가능한 저장 구조의 주요 차이점은 무엇이며, 각각의 전형적인 예는 무엇인가요?

변경 불가능한 저장 구조와 변경 가능한 저장 구조는 데이터 수정 방식과 데이터 접근 방식에서 주로 차이가 납니다.

<!--more-->

- **변경 가능한 저장 구조**: 원래 위치에서 직접 레코드를 수정하는 현장 업데이트 방식을 사용합니다. 읽기 성능에 최적화되어 있지만 데이터를 수정하기 전에 위치를 찾아야 하므로 쓰기 성능이 떨어질 수 있습니다. 대표적인 예로는 **B-트리**가 있으며, 무작위 I/O 작업, 노드 분할 및 병합이 필요할 수 있고 한 셀만 수정되어도 전체 페이지를 다시 써야 할 수 있습니다.
    
- **변경 불가능한 저장 구조**: 수정 시 기존 레코드를 변경하는 대신 새 레코드를 추가하는 추가 전용 방식을 사용합니다. 이 방식은 쓰기 성능에 최적화되어 있지만, 읽기 작업 시 다양한 버전의 데이터 레코드를 조정해야 하므로 읽기 성능이 떨어질 수 있습니다. **로그 구조 병합 트리(LSM 트리)**는 변경 불가능한 구조의 표준 예로, B-트리와 달리 페이지 다시 쓰기의 필요성을 최소화하고 일부 I/O 작업을 순차적으로 처리합니다.

### LSM 트리(Log-Structured Merge Trees)가 변경 불가능한 디스크 저장 구조로서 순차적 쓰기를 어떻게 달성하나요?

LSM 트리는 버퍼링과 추가 전용 저장소를 사용하여 순차적 쓰기를 달성합니다. 이 구조는 디스크에 존재하는 구조체로, B-트리와 유사하게 노드가 완전히 차 있는데, 이는 순차적 디스크 접근을 최적화하기 위함입니다. LSM 트리는 변경 불가능한 파일들을 작성하고 시간이 지남에 따라 이 파일들을 병합합니다. 이 병합은 공간을 회수하고 중복 복사본을 정리하는 유지보수 작업 도중, 그리고 사용자에게 내용을 반환하기 전에 읽기 작업 도중에 발생합니다. LSM 트리는 메모리에 있는 테이블에서 변경 사항을 버퍼링하여 데이터 파일 쓰기를 지연시키며, 이 변경 사항은 불변 디스크 파일로 쓰여집니다. 이로 인해 쓰기 성능과 처리량이 크게 향상됩니다.

### LSM 트리(Log-Structured Merge Trees)의 이점은 무엇인가요?

이 구조는 쓰기 오버헤드를 최소화하고, 동시 읽기 및 쓰기를 간소화하는 장점이 있습니다.

### LSM 트리의 메모리 내 구성 요소와 디스크 구성 요소의 차이점은 무엇인가요?

메모리 내 구성 요소(메모리 테이블 또는 memtable이라고 함)는 변경 가능하며, 데이터 레코드를 버퍼링하고 읽기 및 쓰기 작업의 대상입니다. 디스크 구성 요소는 메모리에서 버퍼링된 내용이 플러시될 때 구축되며, 주로 읽기 작업에 사용됩니다. 메모리 내 구성 요소는 즉시 접근 가능하며 디스크 접근에 따른 I/O 비용이 없는 반면, 디스크 구성 요소는 영구 저장을 위해 사용됩니다.

### LSM 트리에서 데이터 레코드의 병합 과정은 어떻게 진행되나요?

LSM 트리에서는 디스크 구성 요소와 메모리 내 구성 요소의 내용이 병합되어 새로운 디스크 세그먼트로 기록됩니다. 이 병합은 두 구성 요소가 모두 정렬된 상태로 유지되므로, 반복자를 사용하여 두 소스의 내용을 순차적으로 읽고 병합합니다. 이 과정은 정렬된 결과를 생성하여 데이터의 일관성과 효율성을 보장합니다.

### LSM 트리가 B-트리와 비교하여 가지는 장점은 무엇인가요?

LSM 트리는 쓰기 및 삭제 작업에서 높은 효율성을 제공하며, 특히 쓰기 집중적인 환경에서 유리합니다. B-트리와 비교할 때, LSM 트리는 쓰기 증폭을 감소시키고, 메모리 버퍼링과 디스크 병합을 통해 높은 처리량과 향상된 쓰기 성능을 제공합니다. 하지만 읽기 작업에서는 B-트리가 일반적으로 더 빠르게 접근할 수 있는 반면, LSM 트리는 병합된 데이터를 검색하는 데 더 많은 시간이 필요할 수 있습니다.

### 쓰기 증폭은 무엇인가요?

쓰기 증폭(Write Amplification)은 데이터 저장 시스템에서 데이터를 쓸 때 발생하는 현상으로, 실제 애플리케이션 레벨에서 요청된 데이터 양보다 저장 매체에 쓰여지는 데이터 양이 더 많아지는 것을 말합니다. 이는 주로 SSD(Solid State Drive)나 LSM 트리(Log-Structured Merge Tree) 같은 저장 시스템에서 관찰됩니다.

### 쓰기 증폭의 원인은 무엇인가요?

1. **데이터 병합**: LSM 트리와 같은 시스템에서는 새 데이터가 기존 데이터와 병합될 때 전체 데이터 세트를 새 위치에 다시 쓰게 됩니다. 이 과정에서 동일한 데이터가 여러 번 디스크에 쓰여질 수 있습니다.
2. **가비지 컬렉션**: SSD와 같은 플래시 메모리 기반 저장 시스템에서는 데이터가 삭제될 때 물리적으로 즉시 지워지지 않고, 대신 유효하지 않은 데이터로 표시됩니다. 나중에 이러한 영역이 다시 사용되려면 가비지 컬렉션 과정을 통해 유효 데이터를 다른 곳으로 이동시키고 전체 블록을 지워야 합니다. 이 과정에서 추가적인 쓰기 작업이 발생할 수 있습니다.
3. **오버 프로비저닝**: 저장 장치가 실제 사용 가능한 공간보다 더 많은 공간을 관리하기 위해 사용하는 기술로, 가비지 컬렉션과 같은 백그라운드 작업을 효율적으로 처리할 수 있게 해줍니다. 이는 쓰기 성능을 향상시키지만, 더 많은 데이터가 장치에 쓰여지게 만들 수 있습니다.

### 어떻게 하면 쓰기 증폭을 최소화할 수 있나요?

데이터 압축, 효율적인 가비지 컬렉션 알고리즘, 적절한 데이터 배치 전략 등이 있습니다. 이러한 기법들은 쓰기 효율을 최적화하고 저장 장치의 수명을 연장하는 데 도움이 됩니다.

### 오버 프로비저닝은 무엇인가요?

오버 프로비저닝(Over-Provisioning)은 저장 장치에서 사용자에게는 보이지 않는 방식으로 일부 저장 공간을 의도적으로 비워 두는 기술입니다. 이는 주로 SSD(Solid State Drive)와 같은 플래시 기반 저장 장치에서 사용되며, 성능을 최적화하고 장치 수명을 연장하는 데 도움이 됩니다.

### 왜 SSD에서 중요한가요?

오버 프로비저닝은 저장 장치에서 실제 사용자 데이터 저장용으로 할당된 공간 이외에 추가적인 공간을 비워 두는 기술입니다. 이 비워진 공간은 사용자 데이터로는 채워지지 않으며, 장치의 가비지 컬렉션, 웨어 레벨링(셀의 마모를 균일하게 분포시키는 기술)과 같은 내부 작업을 위해 사용됩니다. SSD에서 오버 프로비저닝은 특히 중요한데, 이는 쓰기 증폭을 감소시키고, 더 빠른 쓰기 속도와 향상된 성능을 제공합니다. 또한, 셀의 마모를 균등하게 분배하여 SSD의 수명을 연장시키는 역할을 합니다. 이런 이유로 오버 프로비저닝은 고성능을 요구하는 시스템에서 매우 중요한 기능으로 간주됩니다.

### LSM 트리에서 '메모리 상주 구성 요소'와 '디스크 상주 구성 요소'의 주요 기능은 무엇인가요?

메모리 상주 구성 요소(주로 'memtable'로 불림)는 데이터 레코드를 버퍼링하고 읽기 및 쓰기 작업의 대상으로 사용됩니다. 이 구성 요소는 디스크에 접근하지 않고 메모리 내에서 데이터를 처리하므로 I/O 비용이 발생하지 않습니다. 디스크 상주 구성 요소는 메모리에서 버퍼링된 내용을 디스크로 플러시하고, 주로 읽기 작업에 사용됩니다. 이 구성 요소는 데이터가 한 번 쓰여지면 수정되지 않으며, 영구적으로 저장됩니다.

### LSM 트리의 '쓰기 선행 로그(write-ahead log)' 파일의 목적은 무엇인가요?

쓰기 선행 로그 파일은 데이터 레코드의 내구성을 보장하기 위해 사용됩니다. 데이터 레코드는 로그에 추가되고 메모리에 커밋된 후 클라이언트에게 작업이 완료되었음이 확인됩니다. 이 로그 파일은 시스템이 회복될 때 데이터의 일관성을 유지하는 데 필수적입니다.

### LSM 트리에서 데이터가 디스크로 플러시되는 조건은 무엇인가요?

메모리 상주 구성 요소(memtable)의 크기가 설정된 임계값에 도달하면 데이터가 디스크로 플러시됩니다. 이 과정은 메모리에서 버퍼링된 데이터를 디스크 상주 구성 요소로 옮겨 데이터를 영구적으로 저장하게 합니다.

### LSM 트리에서 메모리와 디스크 구성 요소 간의 데이터 병합 과정은 어떻게 이루어지나요?

데이터 병합 과정은 메모리 상주 구성 요소에서 데이터가 디스크 상주 구성 요소로 플러시될 때 수행됩니다. 이 과정에서 메모리의 데이터와 디스크의 데이터가 병합되어 새로운 디스크 세그먼트로 저장됩니다. 이 병합은 데이터의 최신 버전을 유지하고, 읽기 성능을 최적화하는 데 필요합니다.

이러한 질문과 답변은 LSM 트리의 구조와 주요 운영 메커니즘을 명확하게 이해하는 데 도움을 줄 수 있습니다.
